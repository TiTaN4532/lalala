{% extends "LaNetAdminBundle::layout.html.twig" %}

{% block content %}
  <h3>Брeнды</h3>
  <button id="add-brand-btn">Добавить брeнд</button>
        {% for flashMessage in app.session.flashbag.get('notice_brand') %}
          <div class="flash-notice success">
              {{ flashMessage }}
          </div>
        {% endfor %}
        
         <form action="">
            <input placeholder="Поиск бренда" style="margin-bottom:0;width:80%;" type="text" name="name" {% if app.request.query.get('name') %}value="{{ app.request.query.get('name') }}"{% endif %}>
            <input style="margin-left:10px;" type="submit" value="Найти">
        </form>
        
  {% if pagination.count %}
        <table>
            <thead>
                <tr>
                    <th>Название</th>
                    <th>Статус</th>
                    <th>Валидация</th>
                    <th>Удалить бренд</th>
                    <th>Редактировать бренд</th>
                    <th>Позиция в ТОП</th>
                </tr>
            </thead>
            <tbody>
                {% for brand in pagination %}
                    <tr>
                        <td>{{ brand.name }}</td>
                        <td>{{ brand.isdraft ? 'Скрыто' : 'Опубликовано'}}</td>
                        <td>{{ brand.validation == 1 ? 'Подтвержден' : 'Не подтвержден' }}</td>
                        <td><a href="{{ path('la_net_admin_brand_delete', {'id': brand.id}) }}" class="delete-brand">Удалить</a></td>
                        <td><a href="{{ path('la_net_admin_brand_edit', {'id': brand.id}) }}">Редактировать</a></td>
                        <td>
                            <a href="{{ path('la_net_admin_ajax_inTop_brand', {'id': brand.id} ) }}" class="update-post button">{% if brand.inTop == NULL %}Вывести в ТОП{% else %}Удалить из ТОП{% endif %}</a>
                            {% if brand.getUser.premium is defined %}<a href="{{ path('la_net_admin_ajax_premium_brand', {'id': brand.id} ) }}" class="premium button">{% if brand.getUser.premium == NULL %}Добавить премиум{% else %}Удалить премиум{% endif %}</a>{% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div>
            На данный момент нет брeндов.
        </div>
    {% endif %}
    {{ knp_pagination_render(pagination) }}
  <script type="text/javascript">
      $(document).ready(function() {
          $('#add-brand-btn').click(function() {
              window.location = Routing.generate('la_net_admin_brand_create')
          });
          $('.delete-brand').click(function(event) {
            event.preventDefault();
            if(confirm("Уверены что хотите удалить?")) {
            var element = $(this);
            $.ajax({
                url         : element.attr('href'),
                success     : function(data) {
                  if(data.success) 
                    element.parent().parent().remove();
                  else 
                    alert('Probably there are products related to this brand');
            }
            });
        }
          });
      });
  </script>
  
   <script type="text/javascript">
    
          $('.update-post').click(function(event) {
            event.preventDefault();
            var element = $(this);
            $.ajax({
                url         : element.attr('href'),
                success     : function(data) {
                    
                    if (element.text() == "Вывести в ТОП"){
                            element.text('Удалить из ТОП')
            
                    } else {
                            element.text('Вывести в ТОП')
                    }
                }
            });
          });
          
          $('.premium').click(function(event) {
            event.preventDefault();
            var element = $(this);
            $.ajax({
                url         : element.attr('href'),
                success     : function(data) {
                    
                    if (element.text() == "Добавить премиум"){
                            element.text('Удалить премиум')
            
                    } else {
                            element.text('Добавить премиум')
                    }
                }
            });
          });
     
  </script>
{% endblock %}
